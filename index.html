<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Python File Grid Viewer</title>
<style>
  body { display: flex; font-family: sans-serif; margin: 20px; }
  #sidePanel { width: 250px; border: 1px solid #ccc; padding: 10px; }
  #sidePanel button { width: 100%; margin-bottom: 5px; text-align: left; }
  #canvasContainer { flex: 1; margin-left: 20px; }
  canvas { border: 1px solid #000; }
</style>
</head>
<body>

<div id="sidePanel">
  <h3>Python Files</h3>
  <div id="fileButtons">Loading...</div>
</div>

<div id="canvasContainer">
  <canvas id="canvas"></canvas>
</div>

<script>
async function loadFiles() {
    const res = await fetch("/files");
    const files = await res.json();
    const container = document.getElementById("fileButtons");
    container.innerHTML = "";

    files.forEach(f => {
        const btn = document.createElement("button");
        btn.textContent = f.split("/").pop();
        btn.onclick = () => drawGrid(f);
        container.appendChild(btn);
    });
}

async function drawGrid(filePath) {
    const res = await fetch(`/grid?file=${encodeURIComponent(filePath)}`);
    if (!res.ok) { alert("Error fetching grid"); return; }
    const data = await res.json();

    const side = data.side;
    const bits = data.bits;
    const blockSize = 2;

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = side * blockSize;
    canvas.height = side * blockSize;

    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "black";
    for (let i = 0; i < bits.length; i++) {
        if (bits[i] === "1") {
            const row = Math.floor(i / side);
            const col = i % side;
            ctx.fillRect(col * blockSize, row * blockSize, blockSize, blockSize);
        }
    }
}

// Load file buttons on page load
loadFiles();
</script>

</body>
</html>
